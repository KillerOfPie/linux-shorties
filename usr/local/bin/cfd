#!/bin/bash

SOURCE_DIR=$( dirname -- "$( readlink -f -- "$0"; )"; ) # get the directory of the script

case "$1" in
    status||service)
        echo "running || sudo systemctl status cloudflared ||"
        sudo systemctl status cloudflared
        ;;
    stop)
        echo "running || sudo systemctl stop cloudflared ||"
        sudo systemctl stop cloudflared
        ;;
    restart)
        echo "running || sudo systemctl restart cloudflared ||"
        sudo systemctl restart cloudflared
        ;;
    start)
        echo "running || sudo systemctl start cloudflared ||"
        sudo systemctl start cloudflared
        ;;
    log)
        echo "running || sudo journalctl --catalog --lines=($2|100) --unit=cloudflared.service ||"
        lines=${2:-100}
        if ! [[ "$lines" =~ ^[0-9]+$ ]]; then
            lines=100
        fi
        sudo journalctl --catalog --lines=$lines --unit=cloudflared.service
        ;;
    edit)
        echo "running || sudo nano /etc/cloudflared/config.yml ||"
        sudo nano /etc/cloudflared/config.yml
        ;;
    update)
        index=$(curl https://raw.githubusercontent.com/KillerOfPie/linux-shorties/master/index/cfd)
        echo "pulling /$index from github KillerOfPie/linux-shorties"
        sudo wget -O "/$index" https://raw.githubusercontent.com/KillerOfPie/linux-shorties/master/$index
        sudo chmod +x "/$index"
        ;;
    *|help)
        echo "Usage: $0 {start|stop|restart|status}"
        echo "start: start the cloudflared service"
        echo "stop: stop the cloudflared service"
        echo "restart: restart the cloudflared service"
        echo "status || service: show the status of the cloudflared service"
        echo "log [lines]: show the log of the cloudflared service"
        echo "edit: edit the cloudflared config file"
        echo "update: update this script"
        exit 1
        ;;
esac